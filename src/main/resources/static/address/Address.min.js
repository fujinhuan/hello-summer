!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&(define.amd||define.cmd)?define(t):e.Address=t()}(this,function(){"use strict";var utils=function(){var e=function(e,t,s){if(e){if("string"==typeof t)return e.addEventListener(t,s,!1);for(var i=0,n=t.length;i<n;i++)e.addEventListener(t[i],s,!1)}},t=function(e,t,s){if(e){if("string"==typeof t)return e.removeEventListener(t,s,!1);for(var i=0,n=t.length;i<n;i++)e.removeEventListener(t[i],s,!1)}},s=function(e){return"string"==typeof e?document.querySelector(e):e},i=function(e){return document.createElement(e)},n=function(e,t){return-1<(" "+e.className+" ").indexOf(" "+t+" ")};return{$:s,on:e,off:t,create:i,addClass:function(e,t){n(e,t)||(e.className+=(""===e.className?"":" ")+t)},removeClass:function(e,t){if(n(e,t)){var s=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(s,"")}},position:function(e){var t=e.getBoundingClientRect(),s=e.ownerDocument,i=s.body,n=s.documentElement,a=n.clientTop||i.clientTop||0,r=n.clientLeft||i.clientLeft||0;return{x:t.left+(self.pageXOffset||n.scrollLeft||i.scrollLeft)-r,y:t.top+(self.pageYOffset||n.scrollTop||i.scrollTop)-a}},loadCss:function(e){var t=document.scripts,s=t[t.length-1].src,i=document.getElementsByTagName("head")[0],n=document.createElement("link");s=s.substring(0,s.lastIndexOf("/")),n.rel="stylesheet",n.href=s+"/"+e,i.appendChild(n)}}}();utils.loadCss("Address.css");var ajax=function(opts){var opts=opts||{},url=opts.url,type=opts.type||"GET",dataType=opts.dataType||"json",data=opts.data||{},header=opts.header||{"content-type":"application/x-www-form-urlencoded"},async=opts.async||!0,cache=opts.cache||!0,timeout=opts.timeout||5e3,error=opts.error||function(){},success=opts.success||function(){},progress=opts.progress||function(){},isPost=!("post"!==type.toLowerCase()),isJson=!("json"!==dataType.toLowerCase()),formdata=!(void 0===window.FormData),req=[],fd=null,xhr=null,setHeader=function(){for(var e in header)header.hasOwnProperty(e)&&xhr.setRequestHeader(e,header[e])},setValue=function(e,t){formdata&&fd.append(e,t),req.push(encodeURIComponent(e)+"="+encodeURIComponent(t))},setData=function(){for(var e in data)data.hasOwnProperty(e)&&setValue(e,data[e])},setUrl=function(){url+=(url.indexOf("?")<0?"?":"&")+req.join("&"),cache||(url+=(url.indexOf("?")<0?"?":"&")+"_="+ +new Date)},ajax1=function(){var aborted=!1,checkTimeout=function(){4!=xhr.readyState&&(aborted=!0,xhr.abort(),error&&error(xhr))};setData(),xhr=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),xhr.onreadystatechange=function(){if(4==xhr.readyState&&!aborted)if(xhr.status>=200&&xhr.status<300){var res=xhr.responseText;isJson&&(res=window.JSON&&JSON.parse?JSON.parse(res):eval("("+res+")")),success&&success(res)}else error&&error(xhr)},isPost||setUrl(),xhr.open(type,url,async),setTimeout(checkTimeout,timeout),isPost&&setHeader(),xhr.send(isPost?req.join("&"):null)},ajax2=function(){fd=new FormData,setData(),xhr=new XMLHttpRequest,xhr.onload=function(){var e=xhr.responseText;isJson&&(e=JSON.parse(e)),success&&success(e)},xhr.onerror=function(){error&&error()},xhr.ontimeout=function(){error&&error()},xhr.upload.onprogress=function(e){progress&&progress(e)},isPost||setUrl(),xhr.open(type,url,async),xhr.timeout=timeout,xhr.send(isPost?fd:null)};return formdata?ajax2():ajax1()},data={86:[{code:11e4,name:"北京"},{code:12e4,name:"天津"},{code:13e4,name:"河北"},{code:14e4,name:"山西"},{code:15e4,name:"内蒙古"},{code:21e4,name:"辽宁"},{code:22e4,name:"吉林"},{code:23e4,name:"黑龙江"},{code:31e4,name:"上海"},{code:32e4,name:"江苏"},{code:33e4,name:"浙江"},{code:34e4,name:"安徽"},{code:35e4,name:"福建"},{code:36e4,name:"江西"},{code:37e4,name:"山东"},{code:41e4,name:"河南"},{code:42e4,name:"湖北"},{code:43e4,name:"湖南"},{code:44e4,name:"广东"},{code:45e4,name:"广西"},{code:46e4,name:"海南"},{code:5e5,name:"重庆"},{code:51e4,name:"四川"},{code:52e4,name:"贵州"},{code:53e4,name:"云南"},{code:54e4,name:"西藏"},{code:61e4,name:"陕西"},{code:62e4,name:"甘肃"},{code:63e4,name:"青海"},{code:64e4,name:"宁夏"},{code:65e4,name:"新疆"},{code:71e4,name:"台湾"},{code:81e4,name:"香港"},{code:82e4,name:"澳门"}]},Address=function(e){e=e||{},this.data=e.data||data,this.data&&(this.$input=utils.$(e.input),this.url=e.url,this.url&&(this.parent=e.parent||document.body,this.select=e.select||function(){},this.complete=e.complete||function(){},this.level=1,this.address={province:null,city:null,district:null,town:null},this._init()))};return Address.prototype={_init:function(){this._initEvent()},_initCreate:function(){this.$box=utils.create("dl"),this.$box.className="address-dl",this.$select=utils.create("dt"),this.$select.className="address-dt",this.$wrapper=utils.create("dd"),this.$wrapper.className="address-dd",this.$box.appendChild(this.$select),this.$box.appendChild(this.$wrapper),this.parent.appendChild(this.$box),this._createNav(),this._create()},_createList:function(e){var t=this.data[e];if(t){for(var s=e,i=this.level,n="",a=0,r=t.length;a<r;a++)n+="<span "+(t[a].name===this.activeText?'class="active"':"")+' data-code="'+t[a].code+'" data-pcode="'+s+'" data-level="'+i+'">'+t[a].name+"</span>";this.$wrapper.innerHTML=n}},_create:function(e){var e=e||"86";this._createList(e)},_createNav:function(){var e,t="",s=this.address;if(null===s.province)t+='<span data-code="86" data-level="0">请选择</span>';else for(e in s)null!==s[e]&&(t+="<span "+(s[e][2]===this.level?'class="active"':"")+' data-code="'+s[e][0]+'" data-level="'+s[e][2]+'" data-pcode="'+s[e][3]+'">'+s[e][1]+"</span>");this.$select.innerHTML=t},_addAddress:function(e,t,s,i){switch(e){case 1:this.address.province=[t,s,1,i];break;case 2:this.address.city=[t,s,2,i];break;case 3:this.address.district=[t,s,3,i];break;case 4:this.address.town=[t,s,4,i]}},_removeAddress:function(e){switch(e){case 1:this.address.province=null,this.address.city=null,this.address.district=null,this.address.town=null;break;case 2:this.address.city=null,this.address.district=null,this.address.town=null;break;case 3:this.address.district=null,this.address.town=null;break;case 4:this.address.town=null}},_fetchData:function(e,t,s){var i=this;ajax({url:this.url,data:{level:e,code:t},success:function(e){i.data[t]=e.data,s&&s(e)}})},_initEvent:function(){this.$input&&utils.on(this.$input,"click",function(e){e.stopPropagation(),this.show()}.bind(this))},_bindEvent:function(){this._closeEvent(),this._listEvent(),this._navEvent()},_closeEvent:function(){var e=function(e){e.stopPropagation(),this.hide()};utils.on(document,"click",e.bind(this)),utils.on(this.$box,"click",function(e){e.stopPropagation()})},_listEvent:function(){utils.on(this.$wrapper,"click",function(e){e.stopPropagation();var t=e.target,s=0,i=-1,n=-1,a="",r=null,o=function(){if(r=this.data[n],this._addAddress(s,n,a,i),this._createNav(),this._select(),!r)return void this._selectEnd();this.level=s+1,this._create(n)}.bind(this);if("SPAN"===t.tagName.toUpperCase()){if(s=parseInt(t.getAttribute("data-level")),i=parseInt(t.getAttribute("data-pcode")),n=parseInt(t.getAttribute("data-code")),a=t.innerHTML,void 0!=this.data[n])return void o();this._fetchData(s,n,function(e){o()})}}.bind(this))},_navEvent:function(){utils.on(this.$select,"click",function(e){e.stopPropagation();var t=e.target,s=0,i=-1;if("SPAN"===t.tagName.toUpperCase()){if(s=parseInt(t.getAttribute("data-level")),i=parseInt(t.getAttribute("data-pcode")),!s)return;if(this._removeAddress(s),this.level=s-1,this._createNav(),this._select(),this.level=s,this.data[i])return void this._create(i);this._fetchData(s-1,i,function(e){this._create(i)}.bind(this))}}.bind(this))},_getAddress:function(){var e=[];return null!==this.address.province&&(e[0]=this.address.province[1]),null!==this.address.city&&(e[1]=this.address.city[1]),null!==this.address.district&&(e[2]=this.address.district[1]),null!==this.address.town&&(e[3]=this.address.town[1]),e},_getCode:function(){var e=[];return null!==this.address.province&&(e[0]=this.address.province[0]),null!==this.address.city&&(e[1]=this.address.city[0]),null!==this.address.district&&(e[2]=this.address.district[0]),null!==this.address.town&&(e[3]=this.address.town[0]),e},_setAddress:function(){if(this.$input){var e=this._getAddress();"INPUT"===this.$input.tagName.toUpperCase()?this.$input.value=e.join(" "):this.$input.innerHTML=e.join(" ")}},_setArea:function(e,t){for(var e=e.indexOf(",")>-1?e.split(","):e.split(" "),t=t.indexOf(",")>-1?t.split(","):t.split(" "),s="86",i=0,n=e.length;i<n;i++)this._addAddress(i+1,t[i],e[i],s),s=t[i];if(s=t[n-2],this.level=n,this._createNav(),this.data[s])return void this._create(s);this._fetchData(n-1,s,function(e){this._create(s)}.bind(this))},_select:function(){this.select&&this.select(this._getAddress(),this._getCode())},_selectEnd:function(){this.hide(),this.complete&&this.complete(this._getAddress(),this._getCode())},_setup:function(){this._initCreate(),this._bindEvent()},_position:function(){var e=utils.position(this.$input).x,t=utils.position(this.$input).y,s=this.$input.offsetHeight,i=e,n=t+s;this.$box.style.left=i+"px",this.$box.style.top=n+"px"},hide:function(){this.$box.style.display="none"},show:function(){this.$box||this._setup(),this.$box.style.display="block",this._position()},initArea:function(e,t){""!==e&&""!==t&&(this.$box||this._setup(),this._setArea(e,t))}},Address});